<% layout('layouts/boilerplate') %>

<main class="pt-5 mt-5">
  <div id="map" style="width: 100%; height: 500px"></div>
<!-- Flash Messages -->
  <% if (success && success.length) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= success %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>
  
  <% if (error && error.length) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <%= error %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %><div class="d-flex gap-1 justify-content-between align-items-center">
      <h2 class="text-center my-4">Campgrounds</h2>
        <!-- Create New Campground -->
    <div class="text-center">
      <a href="/campgrounds/new" class="btn btn-success btn-lg">Create New Campground</a>
    </div>
</div>
  <div class="container">
    <div class="row g-4">
        

      <% for (let campground of campgrounds) { %>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">

          <!-- Fixed-size image -->
          <div style="height: 200px; overflow: hidden;">
            <img src="<%= campground.images.length != 0 ? campground.images[0].url : "https://placehold.co/600x400?text=No+Image" %>"
                 class="card-img-top w-100 h-100"
                 style="object-fit: cover;"
                 alt="<%= campground.title %>">
          </div>

          <!-- Card body -->
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><%= campground.title %></h5>
            <p class="card-text text-muted flex-grow-1">
              <%= campground.description ? campground.description.substring(0, 80) + "..." : "No description" %>
            </p>
            <a href="/campgrounds/<%= campground._id %>" class="btn btn-primary w-100 mt-3">
              View Campground
            </a>
          </div>

        </div>
      </div>
      <% } %>

    </div>



  </div>
</main>
<%- "<script>" %>
const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";
const campgrounds = {
  type: "FeatureCollection",
  features: <%- JSON.stringify(
    campgrounds.map(campground => ({
      type: "Feature",
      geometry: campground.geometry,
      properties: { popUpMarkup: campground?.properties?.popUpMarkup }
    }))
  ) %>
};
<%- "</script>" %>

<script src="/javascripts/clusterMap.js"></script>
